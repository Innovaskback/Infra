# Upstream server groups configuration

# Main backend application servers
upstream backend_servers {
    # Load balancing algorithm: least_conn for better distribution
    #least_conn;
    
    # Backend server pool with health monitoring
    server 64.20.63.3:80 weight=3 max_fails=3 fail_timeout=30s;
    
    # Additional servers (uncomment when ready)
    # server 69.10.55.226:80 weight=1 max_fails=3 fail_timeout=30s;  # Lower weight due to redirects
    # server 162.250.127.91:80 weight=3 max_fails=3 fail_timeout=30s;
    
    # Backup server (activate only if all primary servers fail)
    # server 10.0.0.10:80 backup;
    
    # Connection pooling for performance
    keepalive 32;
    keepalive_requests 100;
    keepalive_timeout 60s;
}

# Storage/Media servers for static content
upstream storage_servers {
    # Round-robin by default for even distribution
    # Can change to ip_hash for session persistence
    
    # Storage server pool
    server 64.20.63.3:8080 weight=2 max_fails=2 fail_timeout=20s;
    
    # Additional storage servers (uncomment when ready)
    # server 69.10.55.226:8080 weight=2 max_fails=2 fail_timeout=20s;
    # server 162.250.127.91:8080 weight=2 max_fails=2 fail_timeout=20s;
    
    # CDN or cloud storage endpoints (if applicable)
    # server cdn.example.com:443 weight=1;
    
    # Connection pooling optimized for large files
    keepalive 16;
    keepalive_requests 50;
    keepalive_timeout 120s;
}

# API servers (if needed for microservices)
upstream api_servers {
    # Use least_conn for API load distribution
    least_conn;
    
    # API server pool
    server 64.20.63.3:3000 weight=2 max_fails=2 fail_timeout=15s;
    
    # Additional API servers
    # server 69.10.55.226:3000 weight=2 max_fails=2 fail_timeout=15s;
    
    # Connection pooling for API requests
    keepalive 64;
    keepalive_requests 200;
    keepalive_timeout 30s;
}

# WebSocket servers (if needed)
upstream websocket_servers {
    # IP hash for WebSocket connection persistence
    ip_hash;
    
    # WebSocket server pool
    server 64.20.63.3:8081 max_fails=2 fail_timeout=10s;
    
    # Additional WebSocket servers
    # server 69.10.55.226:8081 max_fails=2 fail_timeout=10s;
    
    # Connection settings for WebSocket
    keepalive 32;
    keepalive_timeout 60s;
}